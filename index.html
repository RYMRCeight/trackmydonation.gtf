<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <style>
    body {
      font-family: Arial;
      margin: 20px;
      background: #f4f6f9;
    }

    h2 {
      text-align: center;
    }

    .container {
      max-width: 900px;
      margin: auto;
    }

    .card {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }

    input {
      width: 100%;
      padding: 10px;
      margin: 5px 0;
      box-sizing: border-box;
    }

    button {
      padding: 10px;
      width: 100%;
      background: #2d89ef;
      color: white;
      border: none;
      cursor: pointer;
      font-weight: bold;
    }

    button:hover {
      background: #1b5fbf;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }

    th, td {
      padding: 10px;
      border: 1px solid #ddd;
      text-align: center;
    }

    th {
      background: #2d89ef;
      color: white;
    }

    .total {
      font-size: 18px;
      font-weight: bold;
      text-align: right;
      margin-top: 10px;
    }
  </style>
</head>
<body>

<div class="container">

  <h2>Solicitation Logs System</h2>

  <!-- ENCODE SECTION -->
  <div class="card">
    <h3>Encode Donation</h3>
    <input type="text" id="name" placeholder="Donor Name">
    <input type="number" id="amount" placeholder="Amount">
    <button onclick="addRecord()">Save</button>
  </div>

  <!-- DASHBOARD SECTION -->
  <div class="card">
    <h3>Dashboard</h3>

    <table>
      <thead>
        <tr>
          <th>Date</th>
          <th>Donor</th>
          <th>Amount</th>
        </tr>
      </thead>
      <tbody id="tableBody"></tbody>
    </table>

    <div class="total" id="totalAmount"></div>
  </div>

</div>

<script>
function addRecord() {
  const name = document.getElementById("name").value.trim();
  const amount = document.getElementById("amount").value;

  if (!name || !amount) {
    alert("Please fill all fields.");
    return;
  }

  google.script.run.withSuccessHandler(function(){
    alert("Saved successfully!");
    document.getElementById("name").value = "";
    document.getElementById("amount").value = "";
    loadData();
  }).addRecord(name, amount);
}

function loadData() {
  google.script.run.withSuccessHandler(function(data){
    let table = "";
    let total = 0;

    data.forEach(function(row){
      total += Number(row[2]);
      table += `<tr>
        <td>${row[0]}</td>
        <td>${row[1]}</td>
        <td>₱ ${Number(row[2]).toLocaleString()}</td>
      </tr>`;
    });

    document.getElementById("tableBody").innerHTML = table;
    document.getElementById("totalAmount").innerText =
      "Total Collected: ₱ " + total.toLocaleString();
  }).getRecords();
}

loadData();
setInterval(loadData, 5000);
</script>

</body>
</html>
